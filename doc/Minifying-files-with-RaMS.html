<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Minifying files with RaMS</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Minifying files with RaMS</h1>



<!-- This vignette is created from a .Rmd file: please edit that instead. -->
<p>As of version 1.1.0, <code>RaMS</code> also has functions that allow
irrelevant data to be removed from the file to reduce file sizes. Like
<code>grabMSdata</code>, there’s one wrapper function
<code>minifyMSdata</code> that accepts mzML or mzXML files, plus a
vector of <em>m/z</em> values that should either be kept
(<code>mz_include</code>) or removed (<code>mz_exclude</code>). The
function then opens up the provided MS files and removes data points in
the MS<sup>1</sup> and MS<sup>2</sup> spectra that fall outside the
accepted bounds. <code>mz_include</code> is useful when only a few
masses are of interest, as in targeted metabolomics.
<code>mz_exclude</code> is useful when many masses are known to be
contaminants or interfere with peakpicking/plotting abilities. This
minification can shrink a file over three orders of magnitude,
decreasing both processing time and memory allocation later in the
pipeline.</p>
<p>This is also very useful for creating demo MS files -
<code>RaMS</code> uses these functions to produce the sample data in
<code>extdata</code>, with 6 MS files taking up less than 5 megabytes of
disk space. Many other programs provide the ability to shrink files, but
none (known to me) shrink files by excluding <em>m/z</em> values and
instead can only remove certain retention times.</p>
<p>Below, we begin with a large MS file containing both MS<sup>1</sup>
and MS<sup>2</sup> data and extract only the data corresponding to
valine/glycine betaine and homarine.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(RaMS)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>msdata_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="at">package =</span> <span class="st">&quot;RaMS&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">&quot;mzML&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>initial_filename <span class="ot">&lt;-</span> msdata_files[<span class="dv">1</span>]</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>output_filename <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span><span class="fu">paste0</span>(<span class="st">&quot;minified_&quot;</span>, <span class="fu">basename</span>(initial_filename)), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>masses_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">118.0865</span>, <span class="fl">138.0555</span>)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> initial_filename, <span class="at">output_files =</span> output_filename, </span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>             <span class="at">mz_include =</span> masses_of_interest, <span class="at">ppm =</span> <span class="dv">10</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Then, when we open the file up (with <code>RaMS</code> or other
software) we are left with the data corresponding only to those
compounds:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>init_msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(initial_filename)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(output_filename)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(msdata<span class="sc">$</span>MS1, <span class="dv">3</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rt</th>
<th align="right">mz</th>
<th align="right">int</th>
<th align="left">filename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.00085</td>
<td align="right">118.0865</td>
<td align="right">15968431.0</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="even">
<td align="right">4.00085</td>
<td align="right">138.0550</td>
<td align="right">174591.6</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="odd">
<td align="right">4.00085</td>
<td align="right">138.0550</td>
<td align="right">174591.6</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(msdata<span class="sc">$</span>MS2, <span class="dv">3</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="15%" />
<col width="11%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">rt</th>
<th align="right">premz</th>
<th align="right">fragmz</th>
<th align="right">int</th>
<th align="right">voltage</th>
<th align="left">filename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">51.81098</td>
<td align="right">3809.649</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="even">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">58.06422</td>
<td align="right">10133.438</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="odd">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">58.06590</td>
<td align="right">390179.500</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
</tbody>
</table>
<p>Both the TIC and BPC are updated to reflect the smaller file size as
well:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">2.1</span>, <span class="fl">2.1</span>, <span class="fl">1.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">plot</span>(init_msdata<span class="sc">$</span>BPC<span class="sc">$</span>rt, init_msdata<span class="sc">$</span>BPC<span class="sc">$</span>int, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Initial BPC&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">plot</span>(msdata<span class="sc">$</span>BPC<span class="sc">$</span>rt, msdata<span class="sc">$</span>BPC<span class="sc">$</span>int, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;New BPC&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="80%" style="display: block; margin: auto;" /></p>
<hr />
<p>The <code>minifyMSdata</code> function is vectorized so the exact
same syntax can be used for multiple files:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;mini_mzMLs/&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>output_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mini_mzMLs/&quot;</span>, <span class="fu">basename</span>(msdata_files))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>output_files <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span>output_files, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> msdata_files, <span class="at">output_files =</span> output_files, <span class="at">verbosity =</span> <span class="dv">0</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>             <span class="at">mz_include =</span> masses_of_interest, <span class="at">ppm =</span> <span class="dv">10</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>mini_msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(output_files, <span class="at">verbosity =</span> <span class="dv">0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">ggplot</span>(mini_msdata<span class="sc">$</span>BPC) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>rt, <span class="at">y=</span>int, <span class="at">color=</span>filename)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="80%" style="display: block; margin: auto;" /></p>
<p>These new files are valid according to the validator provided in
MSnbase, which means that most programs should be able to open them, but
this feature is still experimental and may break on quirky data. If that
happens, please feel free to submit a bug report at</p>
<hr />
<p>As an example of how I use this minification function, here’s the
code used to create the minified files in the <code>\extdata</code>
folder that ships with the package. This was especially useful because
the package can’t be more than 5MB but it’s incredibly useful to include
some standalone MS data for demos and vignettes like this one. I don’t
actually run this code in the vignette itself to save compilation time
but it will run if you test it yourself.</p>
<p>These files originate from the <a href="https://sites.google.com/view/anitra-ingalls">Ingalls Lab</a> at
the University of Washington, USA and are published in the manuscript <a href="https://www.sciencedirect.com/science/article/pii/S1434461018301184"><strong>“Metabolic
consequences of cobalamin scarcity in diatoms as revealed through
metabolomics”</strong></a>. Files are downloaded from the corresponding
<a href="https://www.ebi.ac.uk/metabolights/MTBLS703/files">Metabolights
repository</a>.</p>
<p>First, we identify the <em>m/z</em> values we’d like to keep in the
minified files. For the demo data, I’ll use the Ingalls Lab list of
targeted compounds - those we have authentic standards for.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>raw_stans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;https://raw.githubusercontent.com/&quot;</span>,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                             <span class="st">&quot;IngallsLabUW/Ingalls_Standards/&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                             <span class="st">&quot;b098927ea0089b6e7a31e1758e7c7eaad5408535/&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                             <span class="st">&quot;Ingalls_Lab_Standards_NEW.csv&quot;</span>))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>mzs_to_include <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unique</span>(raw_stans[raw_stans<span class="sc">$</span>Fraction1<span class="sc">==</span><span class="st">&quot;HILICPos&quot;</span>,]<span class="sc">$</span>m.z))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Include glycine betaine isotopes for README demo</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>mzs_to_include <span class="ot">&lt;-</span> <span class="fu">c</span>(mzs_to_include, <span class="fl">119.0899</span>, <span class="fl">119.0835</span>)</span></code></pre></div>
<p>Then, we download the raw MS data from the online repository into
which it’s been deposited.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;vignettes/data&quot;</span>))<span class="fu">dir.create</span>(<span class="st">&quot;vignettes/data&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">&quot;ftp://ftp.ebi.ac.uk/pub/databases/metabolights/studies/public/MTBLS703/&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>chosen_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">&quot;170223_Smp_LB12HL_&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;CD&quot;</span>, <span class="st">&quot;EF&quot;</span>), <span class="st">&quot;_pos.mzXML&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span><span class="fu">basename</span>(chosen_files), <span class="st">&quot;170223_Smp_&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">mapply</span>(download.file, chosen_files, <span class="fu">paste0</span>(<span class="st">&quot;vignettes/data/&quot;</span>, new_names), </span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>       <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>, <span class="at">method =</span> <span class="st">&quot;libcurl&quot;</span>)</span></code></pre></div>
<p>The MSMS data wasn’t uploaded, so we handle that separately by
pulling it off the lab computer manually and copying it over to our
temporary directory. If you’re following along, you can skip this chunk
or use your own DDA data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">paste0</span>(<span class="st">&quot;Z:/1_QEdata/2016/2016_Katherine_1335_LightB12_&quot;</span>,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                        <span class="st">&quot;Experiment/170223_KRH_Rerun_1335_LightB12_Exp_HILIC/&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                        <span class="st">&quot;positive/&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                        <span class="st">&quot;170223_Poo_AllCyanoAqExtracts_DDApos_2.mzXML&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>          <span class="at">to =</span> <span class="st">&quot;vignettes/data/DDApos_2.mzXML&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Then we can actually perform the minification:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">library</span>(RaMS)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;inst/extdata&quot;</span>))<span class="fu">dir.create</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>init_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;vignettes/data/&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>out_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">basename</span>(init_files))</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> init_files, <span class="at">output_files =</span> out_files, <span class="at">warn =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>             <span class="at">mz_include =</span> mzs_to_include, <span class="at">ppm =</span> <span class="dv">20</span>)</span></code></pre></div>
<p>Now we have four minified mzXML files in our inst/extdata folder.
However, we’d like to be able to demo the mzML functionality as well as
that of mzXMLs, so we can use <a href="https://proteowizard.sourceforge.io/tools/msconvert.html">Proteowizard’s</a>
<code>msconvert</code> tool because <code>RaMS</code> can’t convert
between mzML and mzXML or vice versa. You’ll need to install
<code>msconvert</code> and add it to your path for this step.</p>
<p>We also use <code>msconvert</code> to trim the files by retention
time, keeping data between 4 and 15 minutes.</p>
<p>Finally, we gzip the files to get them as small as possible, also
using <code>msconvert</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;msconvert inst/extdata/*.mzXML -o inst/extdata/temp --noindex&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;msconvert --mzXML inst/extdata/*.mzXML -o inst/extdata/temp --noindex&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;msconvert inst/extdata/temp/*.mzML --filter </span><span class="sc">\&quot;</span><span class="st">scanTime [240,900]</span><span class="sc">\&quot;</span><span class="st"> -o inst/extdata -g&#39;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;msconvert inst/extdata/temp/*.mzXML --mzXML --filter </span><span class="sc">\&quot;</span><span class="st">scanTime [240,900]</span><span class="sc">\&quot;</span><span class="st"> -o inst/extdata -g&#39;</span>)</span></code></pre></div>
<p>And then for the last few steps, we again rename the files (since
<code>msconvert</code> expands them to their full .raw names) and remove
the ones we don’t need for the demos.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>init_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">gsub</span>(<span class="at">x=</span>init_files, <span class="st">&quot;.*(Smp_|Extracts_)&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">file.rename</span>(init_files, new_names)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;inst/extdata/temp&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;mzXML$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;LB12HL_CD.mzXML.gz&quot;</span>, <span class="st">&quot;LB12HL_EF.mzXML.gz&quot;</span>)))</span></code></pre></div>
<p>To check that the new files look ok, we can see if we can read them
with <code>RaMS</code> and <code>MSnbase</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>MSnbase<span class="sc">::</span><span class="fu">readMSData</span>(<span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>], <span class="at">msLevel. =</span> <span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>RaMS<span class="sc">::</span><span class="fu">grabMSdata</span>(new_names[<span class="dv">1</span>])</span></code></pre></div>
<p>Finally, remember to clean up the original downloads folder</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;vignettes/data&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<hr />
<p>README last built on 2023-12-13</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
