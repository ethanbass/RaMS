<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Minifying files with RaMS</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Minifying files with RaMS</h1>



<!-- This vignette is created from a .Rmd file: please edit that instead. -->
<p>As of version 1.1.0, <code>RaMS</code> also has functions that allow irrelevant data to be removed from the file to reduce file sizes. Like <code>grabMSdata</code>, there’s one wrapper function <code>minifyMSdata</code> that accepts mzML or mzXML files, plus a vector of <em>m/z</em> values that should either be kept (<code>mz_include</code>) or removed (<code>mz_exclude</code>). The function then opens up the provided MS files and removes data points in the MS<sup>1</sup> and MS<sup>2</sup> spectra that fall outside the accepted bounds. <code>mz_include</code> is useful when only a few masses are of interest, as in targeted metabolomics. <code>mz_exclude</code> is useful when many masses are known to be contaminants or interfere with peakpicking/plotting abilities. This minification can shrink a file over three orders of magnitude, decreasing both processing time and memory allocation later in the pipeline.</p>
<p>This is also very useful for creating demo MS files - <code>RaMS</code> uses these functions to produce the sample data in <code>extdata</code>, with 6 MS files taking up less than 5 megabytes of disk space. Many other programs provide the ability to shrink files, but none (known to me) shrink files by excluding <em>m/z</em> values and instead can only remove certain retention times.</p>
<p>Below, we begin with a large MS file containing both MS<sup>1</sup> and MS<sup>2</sup> data and extract only the data corresponding to valine/glycine betaine and homarine.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RaMS)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>msdata_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="at">package =</span> <span class="st">&quot;RaMS&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">&quot;mzML&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>initial_filename <span class="ot">&lt;-</span> msdata_files[<span class="dv">1</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>output_filename <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span><span class="fu">paste0</span>(<span class="st">&quot;minified_&quot;</span>, <span class="fu">basename</span>(initial_filename)), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>masses_of_interest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">118.0865</span>, <span class="fl">138.0555</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> initial_filename, <span class="at">output_files =</span> output_filename, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">mz_include =</span> masses_of_interest, <span class="at">ppm =</span> <span class="dv">10</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Then, when we open the file up (with <code>RaMS</code> or other software) we are left with the data corresponding only to those compounds:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>init_msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(initial_filename)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(output_filename)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(msdata<span class="sc">$</span>MS1, <span class="dv">3</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rt</th>
<th align="right">mz</th>
<th align="right">int</th>
<th align="left">filename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.00085</td>
<td align="right">118.0865</td>
<td align="right">15968431.0</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="even">
<td align="right">4.00085</td>
<td align="right">138.0550</td>
<td align="right">174591.6</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="odd">
<td align="right">4.00085</td>
<td align="right">138.0550</td>
<td align="right">174591.6</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(msdata<span class="sc">$</span>MS2, <span class="dv">3</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">rt</th>
<th align="right">premz</th>
<th align="right">fragmz</th>
<th align="right">int</th>
<th align="right">voltage</th>
<th align="left">filename</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">51.81098</td>
<td align="right">3809.649</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="even">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">58.06422</td>
<td align="right">10133.438</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
<tr class="odd">
<td align="right">4.182333</td>
<td align="right">118.0864</td>
<td align="right">58.06590</td>
<td align="right">390179.500</td>
<td align="right">35</td>
<td align="left">minified_DDApos_2.mzML</td>
</tr>
</tbody>
</table>
<p>Both the TIC and BPC are updated to reflect the smaller file size as well:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">2.1</span>, <span class="fl">2.1</span>, <span class="fl">1.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(init_msdata<span class="sc">$</span>BPC<span class="sc">$</span>rt, init_msdata<span class="sc">$</span>BPC<span class="sc">$</span>int, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Initial BPC&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(msdata<span class="sc">$</span>BPC<span class="sc">$</span>rt, msdata<span class="sc">$</span>BPC<span class="sc">$</span>int, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">main =</span> <span class="st">&quot;New BPC&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="80%" style="display: block; margin: auto;" /></p>
<hr />
<p>The <code>minifyMSdata</code> function is vectorized so the exact same syntax can be used for multiple files:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;mini_mzMLs/&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>output_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;mini_mzMLs/&quot;</span>, <span class="fu">basename</span>(msdata_files))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>output_files <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span>output_files, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gz&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> msdata_files, <span class="at">output_files =</span> output_files, <span class="at">verbosity =</span> <span class="dv">0</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">mz_include =</span> masses_of_interest, <span class="at">ppm =</span> <span class="dv">10</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mini_msdata <span class="ot">&lt;-</span> <span class="fu">grabMSdata</span>(output_files, <span class="at">verbosity =</span> <span class="dv">0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mini_msdata<span class="sc">$</span>BPC) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>rt, <span class="at">y=</span>int, <span class="at">color=</span>filename)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="80%" style="display: block; margin: auto;" /></p>
<p>These new files are valid according to the validator provided in MSnbase, which means that most programs should be able to open them, but this feature is still experimental and may break on quirky data. If that happens, please feel free to submit a bug report at</p>
<hr />
<p>As an example of how I use this minification function, here’s the code used to create the minified files in the <code>\extdata</code> folder that ships with the package. This was especially useful because the package can’t be more than 5MB but it’s incredibly useful to include some standalone MS data for demos and vignettes like this one. I don’t actually run this code in the vignette itself to save compilation time but it will run if you test it yourself.</p>
<p>These files originate from the <a href="https://sites.google.com/view/anitra-ingalls">Ingalls Lab</a> at the University of Washington, USA and are published in the manuscript <a href="https://www.sciencedirect.com/science/article/pii/S1434461018301184"><strong>“Metabolic consequences of cobalamin scarcity in diatoms as revealed through metabolomics”</strong></a>. Files are downloaded from the corresponding <a href="https://www.ebi.ac.uk/metabolights/MTBLS703/files">Metabolights repository</a>.</p>
<p>First, we identify the <em>m/z</em> values we’d like to keep in the minified files. For the demo data, I’ll use the Ingalls Lab list of targeted compounds - those we have authentic standards for.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>raw_stans <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;https://raw.githubusercontent.com/&quot;</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;IngallsLabUW/Ingalls_Standards/&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;b098927ea0089b6e7a31e1758e7c7eaad5408535/&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Ingalls_Lab_Standards_NEW.csv&quot;</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>mzs_to_include <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unique</span>(raw_stans[raw_stans<span class="sc">$</span>Fraction1<span class="sc">==</span><span class="st">&quot;HILICPos&quot;</span>,]<span class="sc">$</span>m.z))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Include glycine betaine isotopes for README demo</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>mzs_to_include <span class="ot">&lt;-</span> <span class="fu">c</span>(mzs_to_include, <span class="fl">119.0899</span>, <span class="fl">119.0835</span>)</span></code></pre></div>
<p>Then, we download the raw MS data from the online repository into which it’s been deposited.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;vignettes/data&quot;</span>))<span class="fu">dir.create</span>(<span class="st">&quot;vignettes/data&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>base_url <span class="ot">&lt;-</span> <span class="st">&quot;ftp://ftp.ebi.ac.uk/pub/databases/metabolights/studies/public/MTBLS703/&quot;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>chosen_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">&quot;161024_Smp_LB12HL_&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;AB&quot;</span>, <span class="st">&quot;CD&quot;</span>, <span class="st">&quot;EF&quot;</span>), <span class="st">&quot;_pos.mzXML&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">x=</span><span class="fu">basename</span>(chosen_files), <span class="st">&quot;161024_Smp_&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(download.file, chosen_files, <span class="fu">paste0</span>(<span class="st">&quot;vignettes/data/&quot;</span>, new_names), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>, <span class="at">method =</span> <span class="st">&quot;libcurl&quot;</span>)</span></code></pre></div>
<p>The MSMS data wasn’t uploaded, so we handle that separately by pulling it off the lab computer manually and copying it over to our temporary directory. If you’re following along, you can skip this chunk or use your own DDA data.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">paste0</span>(<span class="st">&quot;Z:/1_QEdata/2016/2016_Katherine_1335_LightB12_&quot;</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;Experiment/170223_KRH_Rerun_1335_LightB12_Exp_HILIC/&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;positive/&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;170223_Poo_AllCyanoAqExtracts_DDApos_2.mzXML&quot;</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">to =</span> <span class="st">&quot;vignettes/data/DDApos_2.mzXML&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Then we can actually perform the minification:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RaMS)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;inst/extdata&quot;</span>))<span class="fu">dir.create</span>(<span class="st">&quot;inst/extdata&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>init_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;vignettes/data/&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>out_files <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">basename</span>(init_files))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">minifyMSdata</span>(<span class="at">files =</span> init_files, <span class="at">output_files =</span> out_files, <span class="at">warn =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">mz_include =</span> mzs_to_include, <span class="at">ppm =</span> <span class="dv">20</span>)</span></code></pre></div>
<p>Now we have four minified mzXML files in our inst/extdata folder. However, we’d like to be able to demo the mzML functionality as well as that of mzXMLs, so we can use <a href="http://proteowizard.sourceforge.net/tools.shtml">Proteowizard’s</a> <code>msconvert</code> tool because <code>RaMS</code> can’t convert between mzML and mzXML or vice versa. You’ll need to install <code>msconvert</code> and add it to your path for this step.</p>
<p>We also use <code>msconvert</code> to trim the files by retention time, keeping data between 4 and 15 minutes.</p>
<p>Finally, we gzip the files to get them as small as possible, also using <code>msconvert</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;msconvert inst/extdata/*.mzXML -o inst/extdata/temp --noindex&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;msconvert --mzXML inst/extdata/*.mzXML -o inst/extdata/temp --noindex&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;msconvert inst/extdata/temp/*.mzML --filter </span><span class="sc">\&quot;</span><span class="st">scanTime [240,900]</span><span class="sc">\&quot;</span><span class="st"> -o inst/extdata -g&#39;</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&#39;msconvert inst/extdata/temp/*.mzXML --mzXML --filter </span><span class="sc">\&quot;</span><span class="st">scanTime [240,900]</span><span class="sc">\&quot;</span><span class="st"> -o inst/extdata -g&#39;</span>)</span></code></pre></div>
<p>And then for the last few steps, we again rename the files (since <code>msconvert</code> expands them to their full .raw names) and remove the ones we don’t need for the demos.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>init_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">gsub</span>(<span class="at">x=</span>init_files, <span class="st">&quot;.*(Smp_|Extracts_)&quot;</span>, <span class="st">&quot;&quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file.rename</span>(init_files, new_names)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;inst/extdata/temp&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;mzXML$&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">paste0</span>(<span class="st">&quot;inst/extdata/&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;LB12HL_CD.mzXML.gz&quot;</span>, <span class="st">&quot;LB12HL_EF.mzXML.gz&quot;</span>)))</span></code></pre></div>
<p>To check that the new files look ok, we can see if we can read them with <code>RaMS</code> and <code>MSnbase</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>MSnbase<span class="sc">::</span><span class="fu">readMSData</span>(<span class="fu">list.files</span>(<span class="st">&quot;inst/extdata&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span>], <span class="at">msLevel. =</span> <span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>RaMS<span class="sc">::</span><span class="fu">grabMSdata</span>(new_names[<span class="dv">1</span>])</span></code></pre></div>
<p>Finally, remember to clean up the original downloads folder</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="st">&quot;vignettes/data&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<hr />
<p>README last built on 2022-04-08</p>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
